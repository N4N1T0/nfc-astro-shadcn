---
// Astro Imports - Layout & Globals
import { Image } from 'astro:assets'
import BaseLayout from '../../layouts/BaseLayout.astro'
import { getCollection, type CollectionEntry } from 'astro:content'

// Utils Imports
import { formatDate, capitalizer } from '../../lib/utils'
import { buttonVariants } from '../../components/ui/button'
import { ChevronLeft } from 'lucide-react'

export async function getStaticPaths() {
  const posts = await getCollection('blog')
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: post,
  }))
}

type Props = CollectionEntry<'blog'>

const post = Astro.props
const { title, date, excerpt, author, categories, image } = post.data
const slug = Astro.params.slug
const { Content } = await post.render()

if (!slug || !post) {
  return new Response(null, {
    status: 404,
    statusText: 'Not found',
  })
}
---

<BaseLayout>
  <div class="container relative max-w-screen-md py-10 pt-10">
    <a
      href="/blog"
      class="absolute left-[-200px] top-10 hidden text-muted-foreground transition-colors duration-200 hover:text-secondary xl:inline-flex"
      transition:animate="slide"
    >
      <ChevronLeft height="20px" />
       See all posts
    </a>

    <article class="prose dark:prose-invert max-w-none">
      {
        categories.map((category) => (
          <a
            class="mr-3 rounded-lg bg-accent px-3 py-1 text-xs text-white no-underline transition-colors duration-200 hover:bg-accent/50 md:text-sm"
            href={`/categories/${category}`}
          >
            {capitalizer(category)}
          </a>
        ))
      }
      <Image
        class="my-6 overflow-hidden rounded-xl"
        width={1020}
        height={510}
        src={image}
        alt={title}
        transition:name={'img-' + slug}
      />
      <div class="flex items-center justify-between">
        <span
          class="font-medium text-muted-foreground"
          transition:name={'date-' + slug}
        >
          {formatDate(date)}
        </span>
        <span class="font-medium text-muted-foreground">
          {author}
        </span>
      </div>
      <h1 class="font-heading my-4 text-4xl" transition:name={'title-' + slug}>
        {title}
      </h1>
      <p>{excerpt}</p>
      <hr class="my-6" />
      <Content />
    </article>
  </div>
</BaseLayout>
